<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<link rel="icon" href="minilogo.png" type="image/x-icon">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Dipo Store</title>
<meta name="description" content="اطلب الآن من Dipo Store واحصل على أفضل العروض مع توصيل لجميع ولايات الجزائر. دفع عند الاستلام وضمان الجودة.">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link rel="stylesheet" href="styles.css">

<script>
  !function(f,b,e,v,n,t,s)
  {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
  n.callMethod.apply(n,arguments):n.queue.push(arguments)};
  if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
  n.queue=[];t=b.createElement(e);t.async=!0;
  t.src=v;s=b.getElementsByTagName(e)[0];
  s.parentNode.insertBefore(t,s)}(window, document,'script',
  'https://connect.facebook.net/en_US/fbevents.js');
  fbq('init', '4201186623447790'); 
  fbq('track', 'PageView');
</script>
<noscript>
    <img height="1" width="1" 
    src="https://www.facebook.com/tr?id=4201186623447790_ID&ev=PageView&noscript=1"/>
  </noscript>
  <script>
  !function(f,b,e,v,n,t,s)
  {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
  n.callMethod.apply(n,arguments):n.queue.push(arguments)};
  if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
  n.queue=[];t=b.createElement(e);t.async=!0;
  t.src=v;s=b.getElementsByTagName(e)[0];
  s.parentNode.insertBefore(t,s)}(window, document,'script',
  'https://connect.facebook.net/en_US/fbevents.js');
  fbq('init', '1191634472173790'); 
  fbq('track', 'PageView');
</script>
<noscript>
    <img height="1" width="1" 
    src="https://www.facebook.com/tr?id=1191634472173790_ID&ev=PageView&noscript=1"/>
  </noscript>
</head>
<body>
<!-- البار العلوي المعدل -->
<div class="top-bar">
  <img src="logo.png" alt="شعار المتجر" class="top-bar-logo">
  <div class="top-bar-content">
    <p>التوصيل متوفر 58 ولاية</p>
    <p>والدفع عند الاستلام، مرحبا بكم</p>
  </div>
  <div class="theme-switcher">
    <button class="theme-toggle-ball" id="themeToggleBall">
      <i class="fas fa-sun theme-icon sun-icon"></i>
      <i class="fas fa-moon theme-icon moon-icon"></i>
    </button>
  </div>
</div>

<div id="loader">
  <div class="spinner">
    <img src="minilogo.png" alt="شعار" class="logo" />
  </div>
</div>

<div class="container">
  <h2>جهاز شفط الرؤوس السوداء وتنظيف البشرة</h2>

  <div class="delivery-estimate">ودّعي جلسات التجميل المكلفة واحصلي على نتائج فورية من بيتك مع جهاز شفط الرؤوس السوداء</div>
  <div class="image-gallery">
    <img src="1.jpg" class="gallery-image active" alt="Image 1">
    <img src="2.jpg" class="gallery-image" alt="Image 2">
    <img src="3.jpg" class="gallery-image" alt="Image 3">
    <img src="4.jpg" class="gallery-image" alt="Image 4">
    <img src="5.jpg" class="gallery-image" alt="Image 5">
    <button class="gallery-nav gallery-prev"><i class="fas fa-chevron-right"></i></button>
    <button class="gallery-nav gallery-next"><i class="fas fa-chevron-left"></i></button>
    <div class="gallery-indicators">
      <div class="gallery-indicator active" data-index="0"></div>
      <div class="gallery-indicator" data-index="1"></div>
      <div class="gallery-indicator" data-index="2"></div>
      <div class="gallery-indicator" data-index="3"></div>
      <div class="gallery-indicator" data-index="4"></div>
    </div>
  </div>
  
  <span style="font-weight: bold; color: var(--primary-color); font-size: 26px;">2400 دج</span> 
  <span style="text-decoration: line-through; color: #6EC1E4; font-size: 23px; margin-left: 10px;">3200 دج</span>
  
  <form id="orderForm">
    <input type="text" id="name" placeholder="أدخل الاسم الكامل" required>
    <input type="tel" id="phone" placeholder="أدخل رقم الهاتف" required style="text-align: right;">
    
    <div class="location-selectors">
      <select id="wilayaSelect" class="p-2 border rounded" required>
        <option value="">اختر الولاية التوصيل للمنزل</option>
      </select>

      <select id="communeSelect" class="p-2 border rounded" required disabled>
        <option value="">اختر البلدية</option>
      </select>
    </div>
    
    <input type="text" id="address" placeholder="أدخل العنوان بالتفصيل" required>
    
    <div class="trust-badges">
      <div class="trust-badge">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
          <polyline points="22 4 12 14.01 9 11.01"></polyline>
        </svg>
        دفع عند الاستلام
      </div>
      <div class="trust-badge">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
          <polyline points="22 4 12 14.01 9 11.01"></polyline>
        </svg>
        ضمان الجودة
      </div>
      <div class="trust-badge">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
          <polyline points="22 4 12 14.01 9 11.01"></polyline>
        </svg>
        دعم على الواتساب
      </div>
    </div>
    
    <div class="social-icons">
      <a href="https://www.facebook.com/profile.php?id=61576026925740" target="_blank" class="social-icon facebook">
        <i class="fab fa-facebook-f"></i>
      </a>
      <a href="https://www.tiktok.com/@dipostore.dz" target="_blank" class="social-icon tiktok">
        <i class="fab fa-tiktok"></i>
      </a>
      <a href="https://www.instagram.com/dipo_store.dz/" target="_blank" class="social-icon instagram">
        <i class="fab fa-instagram"></i>
      </a>
      <a href="https://t.me/dipostorealgeria" target="_blank" class="social-icon telegram">
        <i class="fab fa-telegram-plane"></i>
      </a>
    </div>
    
    <div class="order-summary-section">
      <div class="price-box">
        <div>
          <span>سعر المنتج:</span>
          <span id="productPrice">2400</span>
          <span>دج</span>
        </div>
        <div>
          <span>سعر التوصيل:</span>
          <span id="deliveryPrice">اختر الولاية</span>
          <span>دج</span>
        </div>
        <div class="total-price">
          <span>المجموع:</span>
          <span id="totalPrice">--</span>
          <span>دج</span>
        </div>
      </div>
      
      <div class="action-container">
        <div class="quantity-control">
          <button type="button" onclick="changeQuantity(-1)">-</button>
          <input type="text" id="quantity" value="1" readonly>
          <button type="button" onclick="changeQuantity(1)">+</button>
        </div>
        <button type="submit" class="submit-btn" id="submitBtn">إرسال الطلب</button>
      </div>
    </div>
  </form>
</div>
<div class="copyright-footer" style="text-align: center; padding: 5px; color: var(--text-color); font-size: 12px; background-color: var(--background-color);">
 كل الحقوق محفوظة لدى Copyright © 2025 - Dipo Store
</div>

<script>
// نظام الثيم
const themeToggleBall = document.getElementById('themeToggleBall');
const body = document.body;
const sunIcon = document.querySelector('.sun-icon');
const moonIcon = document.querySelector('.moon-icon');

body.classList.add('dark-mode');
sunIcon.style.opacity = '0';
sunIcon.style.transform = 'translateY(-20px)';
moonIcon.style.opacity = '1';
moonIcon.style.transform = 'translateY(0)';
localStorage.setItem('theme', 'dark');

themeToggleBall.addEventListener('click', function() {
  body.classList.toggle('dark-mode');
  
  if (body.classList.contains('dark-mode')) {
    localStorage.setItem('theme', 'dark');
    sunIcon.style.opacity = '0';
    sunIcon.style.transform = 'translateY(-20px)';
    moonIcon.style.opacity = '1';
    moonIcon.style.transform = 'translateY(0)';
  } else {
    localStorage.setItem('theme', 'light');
    sunIcon.style.opacity = '1';
    sunIcon.style.transform = 'translateY(0)';
    moonIcon.style.opacity = '0';
    moonIcon.style.transform = 'translateY(20px)';
  }
});

// أسعار التوصيل لكل ولاية (للمنزل فقط الآن)
const prices = {
  '01': 1000,
  '02': 600,
  '03': 750,
  '04': 700,
  '05': 650,
  '06': 550,
  '07': 800,
  '08': 1000,
  '09': 250,
  '10': 600,
  '11': 1200,
  '12': 700,
  '13': 700,
  '14': 700,
  '15': 550,
  '16': 250,
  '17': 700,
  '18': 600,
  '19': 550,
  '20': 750,
  '21': 650,
  '22': 650,
  '23': 550,
  '24': 700,
  '25': 550,
  '26': 600,
  '27': 600,
  '28': 650,
  '29': 650,
  '30': 800,
  '31': 500,
  '32': 850,
  '33': 1300,
  '34': 600,
  '35': 500,
  '36': 700,
  '37': 1300,
  '38': 700,
  '39': 800,
  '40': 700,
  '41': 800,
  '42': 500,
  '43': 650,
  '44': 600,
  '45': 900,
  '46': 600,
  '47': 800,
  '48': 600,
  '49': 1200,
  '50': 1400,
  '51': 800,
  '52': 1000,
  '53': 1400,
  '54': 1550,
  '55': 850,
  '56': 900,
  '57': 900,
  '58': 900
};

// الثوابت والمتغيرات
const productPrice = 2400;
const freeShippingThreshold = 50000;
const wilayaSelect = document.getElementById('wilayaSelect');
const communeSelect = document.getElementById('communeSelect');
const deliveryPriceEl = document.getElementById('deliveryPrice');
const totalPriceEl = document.getElementById('totalPrice');
const quantityInput = document.getElementById('quantity');
const phoneInput = document.getElementById('phone');
const orderForm = document.getElementById('orderForm');
const submitBtn = document.getElementById('submitBtn');

// تحميل بيانات الولايات والبلديات
document.addEventListener('DOMContentLoaded', function() {
  loadWilayasAndCommunes();
  setupEventListeners();
  initImageGallery();
});

// تحميل بيانات الولايات والبلديات من ملف JSON
function loadWilayasAndCommunes() {
  fetch('communes.json')
    .then(response => {
      if (!response.ok) throw new Error('Network response was not ok');
      return response.json();
    })
    .then(data => {
      populateWilayas(data);
      setupWilayaChangeListener(data);
    })
    .catch(error => {
      console.error('Error loading the data:', error);
      wilayaSelect.innerHTML = '<option value="">خطأ في تحميل البيانات</option>';
    });
}

// تعبئة قائمة الولايات
function populateWilayas(data) {
  wilayaSelect.innerHTML = '<option value="">اختر الولاية التوصيل للمنزل</option>';
  
  const wilayasMap = new Map();
  data.forEach(item => {
    if (!wilayasMap.has(item.wilaya_code)) {
      wilayasMap.set(item.wilaya_code, {
        code: item.wilaya_code,
        name: item.wilaya_name
      });
    }
  });

  const sortedWilayas = Array.from(wilayasMap.values()).sort((a, b) => a.code.localeCompare(b.code));

  sortedWilayas.forEach(wilaya => {
    const option = document.createElement('option');
    option.value = wilaya.code;
    option.textContent = `${wilaya.code} - ${wilaya.name}`;
    wilayaSelect.appendChild(option);
  });
}

// إعداد مستمع لتغيير الولاية
function setupWilayaChangeListener(data) {
  wilayaSelect.addEventListener('change', function() {
    const selectedCode = this.value;
    communeSelect.innerHTML = '<option value="">اختر البلدية</option>';
    communeSelect.disabled = !selectedCode;

    if (!selectedCode) {
      updatePrices();
      return;
    }

    const communes = data.filter(item => item.wilaya_code === selectedCode);
    
    if (communes.length > 0) {
      communes.forEach(item => {
        const option = document.createElement('option');
        option.value = item.commune_name;
        option.textContent = item.commune_name;
        communeSelect.appendChild(option);
      });
    }
    
    updatePrices();
  });

  communeSelect.addEventListener('change', updatePrices);
}

// إعداد مستمعات الأحداث
function setupEventListeners() {
  orderForm.addEventListener('submit', submitOrder);
}

// تحديث الأسعار بناءً على الاختيارات
function updatePrices() {
  const wilaya = wilayaSelect.value;
  const quantity = parseInt(quantityInput.value);
  const subtotal = productPrice * quantity;
  
  if (wilaya && prices[wilaya]) {
    let deliveryPrice = prices[wilaya];
    let total = subtotal + deliveryPrice;
    
    if (subtotal >= freeShippingThreshold) {
      deliveryPrice = 0;
      total = subtotal;
      deliveryPriceEl.innerHTML = '<span style="text-decoration:line-through">' + prices[wilaya] + '</span> 0';
    } else {
      deliveryPriceEl.textContent = deliveryPrice;
    }
    
    totalPriceEl.textContent = total;
  } else {
    deliveryPriceEl.textContent = 'اختر الولاية';
    totalPriceEl.textContent = '--';
  }
}

// تغيير الكمية
function changeQuantity(change) {
  let current = parseInt(quantityInput.value);
  let newVal = current + change;
  
  if (newVal >= 1 && newVal <= 10) {
    quantityInput.value = newVal;
    quantityInput.classList.add('highlight');
    setTimeout(() => quantityInput.classList.remove('highlight'), 500);
    updatePrices();
  }
}

function submitOrder(e) {
  e.preventDefault();
  
  submitBtn.disabled = true;
  submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> جاري الإرسال...';
  
  const name = document.getElementById('name').value;
  const phone = document.getElementById('phone').value;
  const wilaya = wilayaSelect.options[wilayaSelect.selectedIndex].text;
  const commune = communeSelect.value; // تغيير من .text إلى .value
  const address = document.getElementById('address').value;
  const deliveryPrice = deliveryPriceEl.textContent;
  const totalPrice = totalPriceEl.textContent;
  const quantity = quantityInput.value;
  
  const scriptURL = 'https://script.google.com/macros/s/AKfycbz-lFJDNcRdiG83Clxz8khntVXybN1HNwvI_EHf4IqWtbC6Z1aDAfE2HcgOutyWbx48/exec';
  
  const formData = new FormData();
  const productName = document.querySelector('h2').textContent; // الحصول على اسم المنتج من العنوان h2
  
  formData.append('productName', productName.trim()); // إضافة trim() لإزالة المسافات الزائدة
  formData.append('name', name);
  formData.append('phone', phone);
  formData.append('wilaya', wilaya);
  formData.append('commune', commune); // إرسال قيمة البلدية بدلاً من النص
  formData.append('address', address);
  formData.append('deliveryPrice', deliveryPrice);
  formData.append('totalPrice', totalPrice);
  formData.append('quantity', quantity);
  
  fetch(scriptURL, { method: 'POST', body: formData })
    .then(response => {
      window.location.href = 'thankyou.html';
    })
    .catch(error => {
      console.error('حدث خطأ أثناء إرسال الطلب:', error);
      alert('حدث خطأ أثناء إرسال الطلب، يرجى المحاولة مرة أخرى');
      submitBtn.disabled = false;
      submitBtn.textContent = 'إرسال الطلب';
    });
}

// معرض الصور
function initImageGallery() {
  const images = document.querySelectorAll('.gallery-image');
  const indicators = document.querySelectorAll('.gallery-indicator');
  const prevBtn = document.querySelector('.gallery-prev');
  const nextBtn = document.querySelector('.gallery-next');
  let currentIndex = 0;
  let interval;
  
  function showImage(index) {
    images.forEach(img => img.classList.remove('active'));
    indicators.forEach(ind => ind.classList.remove('active'));
    images[index].classList.add('active');
    indicators[index].classList.add('active');
    currentIndex = index;
  }
  
  function nextImage() {
    let newIndex = (currentIndex + 1) % images.length;
    showImage(newIndex);
  }
  
  function prevImage() {
    let newIndex = (currentIndex - 1 + images.length) % images.length;
    showImage(newIndex);
  }
  
  function startSlider() {
    interval = setInterval(nextImage, 3000);
  }
  
  function stopSlider() {
    clearInterval(interval);
  }
  
  nextBtn.addEventListener('click', function() {
    nextImage();
    stopSlider();
    startSlider();
  });
  
  prevBtn.addEventListener('click', function() {
    prevImage();
    stopSlider();
    startSlider();
  });
  
  indicators.forEach((indicator, index) => {
    indicator.addEventListener('click', function() {
      showImage(index);
      stopSlider();
      startSlider();
    });
  });
  
  startSlider();
  
  document.querySelector('.image-gallery').addEventListener('mouseenter', stopSlider);
  document.querySelector('.image-gallery').addEventListener('mouseleave', startSlider);
}

// تحميل الصفحة
window.addEventListener("load", function() {
  const loader = document.getElementById("loader");
  loader.style.display = "none";
});

// زر الطلب العائم
document.addEventListener("DOMContentLoaded", function() {
  const orderNowBtn = document.getElementById("orderNowBtn");
  const nameInput = document.getElementById("name");
  const topBarHeight = document.querySelector('.top-bar').offsetHeight;

  if (orderNowBtn) {
    orderNowBtn.addEventListener("click", function() {
      const topOffset = nameInput.getBoundingClientRect().top + window.scrollY - topBarHeight - 5;
      window.scrollTo({ top: topOffset, behavior: "smooth" });
      orderNowBtn.style.display = "none";
    });

    window.addEventListener('scroll', function() {
      if (window.scrollY > 50) {
        orderNowBtn.style.display = "none";
      }
    });
  }
});
</script>

<a class="whatsapp-button" href="https://wa.me/213797319624" target="_blank" title="تواصل عبر واتساب">
  <img src="whatsapp.png" alt="WhatsApp"/>
</a>

<button class="floating-order-btn" id="orderNowBtn">اطلب الآن</button>
</body>
</html>
